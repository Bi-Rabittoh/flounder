{{$domain := .Host}}
{{$authUser := .AuthUser}}
{{template "header" .}}
<h1>Managing
  <a href="//{{$authUser}}.{{$domain}}">
    {{.AuthUser}}.{{$domain}}
  </a>
</h1>
{{template "nav.html" .}}
<br>
<h3>Your files:</h3>
{{ define "file" }}
<tr>
<div>
  {{ if gt (len .Children) 0 }}
  <td colspan="3">
  <details>
    <summary>
      {{.Name}}/
    </summary>
    <table>
    {{ range .Children }}
    {{ template "file" . }}
    {{ end }}
    </table>
  </details>
  </td>
  {{ else }}
  <td>
    <a href="//authUser.domain/{{.Name}}">
      {{ .Name }}</a>
  </td>
  <td>
  {{ if .IsText }}
  <a href="/edit/{{.Name}}">edit</a>
  {{ end }}
  </td>
  <td>
  <form action="/delete/{{.Name}}" method="POST" class="inline">
    <input
      class="button delete"
      type="submit"
      onclick="return confirm('Are you sure you want to delete this file?');"
      value="delete"
    />
    </form>
  {{ end }}
  </td>
</div>
</tr>
{{ end }}
<table>
{{ range .Files }}
{{ template "file" . }}
{{ end }}
</table>
<h3>Create file by name:</h3>
<noscript>Create a new page by going to /edit/[filename]</noscript>
<input id="edit_new" size=32 placeholder="New filename, e.g. newfile.gmi" />
<a href="#" id="create_new">Edit new file</a><br>
<script>
  var input = document.getElementById('edit_new')
  var create = document.getElementById('create_new')
  create.href = '/edit/' + input.value
  input.onchange = input.onkeyup = function () {
    create.href = '/edit/' + input.value
  }
</script>
<br />
<form action="/upload" enctype="multipart/form-data" method="POST">
  <input type="file" id="myFile" name="file" multiple />
  <input type="submit" value="Upload file" class="button" />
</form>
<br>
<p><a href="/my_site/flounder-archive.zip">🗄️ Download site archive (.zip)</a></p>
{{template "footer" .}}
